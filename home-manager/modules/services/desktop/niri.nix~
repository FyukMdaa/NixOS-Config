{ config, pkgs, lib, ... }:

{
  programs.niri.package = pkgs.niri-stable;

  # 文字列ベースのKDL設定（最も確実）
  programs.niri.config = ''
    input {
        keyboard {
            xkb {
                layout "jp"
            }
        }
    }
    
    output "eDP-1" {
        scale 1.0
    }
    
    layout {
        gaps 8
        center-focused-column "never"
        
        border {
            enable true
            width 2
            active { color "#7dcfff" }
            inactive { color "#414868" }
        }
    }
    
    environment {
        NIXOS_OZONE_WL "1"
        MOZ_ENABLE_WAYLAND "1"
        QT_QPA_PLATFORM "wayland"
    }
    
    spawn-at-startup {
        { command { "mako" } }
        { command { "fcitx5" "-d" } }
        { command { "swww-daemon" } }
    }
    
    binds {
        "Mod+Return" { spawn "ghostty" }
        "Mod+D" { spawn { "wofi" "--show" "drun" } }
        "Mod+Q" { close-window }
        "Mod+Shift+E" { quit }
    }
    
    cursor {
        theme "Adwaita"
        size 24
    }
}
'';

  home.packages = with pkgs; [
    brightnessctl
    mako
    swww
  ];
}
